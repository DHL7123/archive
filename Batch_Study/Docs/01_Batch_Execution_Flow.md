# 스프링 배치 동작 방식

## 배치에서 중요하게 볼 부분

배치는 데이터를 효율적으로 처리하는 것도 중요하지만, 더 중요하게 생각해야 하는 부분은:

1. **작업 진행 상태 추적**: 현재까지 처리한 작업의 위치를 지속적으로 파악 한다.
2. **중복 실행 방지**: 이미 처리한 작업이 스케줄러에 의해 반복 실행되지 않도록 관리 한다.
   (배치는 일반적으로 스케줄러에 의해 실행되기 때문)

>  **핵심 원칙**:  
> 중복이나 데이터 누락을 방지하기 위해 "기록"이 가장 중요하다.
> 이 기본 조건을 충족한 후에야 성능 최적화를 고려할 수 있다.

---

## 배치의 기본 흐름

하나의 배치 작업은 `읽기(Read) → 처리(Process) → 쓰기(Write)`를 **데이터가 없을 때까지 반복**
**왜 한 번에 모두 읽지 않나요?**

- **메모리 부하 방지**: 대량 데이터를 한 번에 읽으면 메모리 오버플로우 발생 가능
- **실패 리스크 관리**: 중간에 실패 시 처음부터 재시작해야 하는 문제
- **성능 최적화**: 청크 단위 처리로 병목 현상 감소

###  택배 회사 운영 예시
1. **한 번에 모두 처리하지 않는 이유?**  
   > "대형 택배 회사가 10만 개의 물건을 한 트럭에 몰아싣지 않고,  
   > 소량으로 나눠 운반하는 것.  
   > - 만약 사고 나면 **10만 개 전체를 다시 보내야** 하지만,  
   > - 100개씩 1,000번 운반하면 사고 시 **마지막 100개만 재전송**하면 됨."

2. **메타데이터의 중요성**  
   > "택배 기사가 **'오늘 57번째 집까지 배달 완료'**라고 메모하는 것처럼,  
   > 배치는 `JobRepository`에 진행 상황을 기록해  
   > 중간에 실패해도 **그 지점부터 재개**할 수 있다."

3. **중복 실행 방지**  
   > "이미 '어제 배송 완료'한 집에  
   > 오늘 또 택배를 가져가는 **슬픈 상황**을 방지하는 것과 같다."

4. **청크(Chunk) 처리**  
   > "물건을 **한 번에 10개씩만 들 수 있는 로봇**이  
   > 100개의 상자를 옮길 때 10번 왕복하는 것처럼,  
   > 배치도 설정한 청크 크기(예: 100개) 단위로 끊어 처리한다."

---

## 배치 활용 사례

| 분야               | 예시                                  |
|--------------------|---------------------------------------|
| 금융               | 은행 이자 계산 (매일 자정 기준 처리)  |
| 구독 서비스        | 회원 권한 주기적 조정                |
| 인사/회계          | 급여 계산                             |
| 데이터 관리        | 주기적 보고서 생성, 불필요 데이터 삭제 |

---

## 스프링 배치 내부 구조

![Spring Batch Architecture](https://docs.spring.io/spring-batch/reference/_images/spring-batch-reference-model.png)  
*(출처: Spring 공식 문서)*

### 주요 컴포넌트

| 컴포넌트         | 역할                                                                 |
|------------------|----------------------------------------------------------------------|
| **JobLauncher**  | 배치 작업(Job)을 실행하는 트리거                                    |
| **Job**          | `읽기 → 처리 → 쓰기` 전체 프로세스를 정의한 작업 단위               |
| **Step**         | Job 내의 개별 처리 단계 (1개의 Job이 여러 Step을 가질 수 있음)      |
| **ItemReader**   | 데이터 소스(DB, 파일 등)에서 데이터 읽기                           |
| **ItemProcessor**| 비즈니스 로직 처리 (필터링, 변환 등)                               |
| **ItemWriter**   | 처리 결과 저장 (DB, 파일 등)                                       |
| **JobRepository**| 실행 횟수, 성공/실패 기록 등 **메타데이터** 저장                   |


